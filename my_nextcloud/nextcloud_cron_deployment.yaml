apiVersion: batch/v1
kind: CronJob
metadata:
  name: nextcloud-cron-cronjob
  labels:
    app: my-nextcloud
spec:
  schedule: "*/5 * * * *"
  timeZone: Asia/Tokyo
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: cron-nextcloud
              image: nextcloud:fpm
              imagePullPolicy: IfNotPresent
              securityContext:
                runAsUser: 33 # user: www-data
                runAsGroup: 33 # group: www-data
              command:
                - php
                - -f
                - /var/www/html/cron.php
              volumeMounts:
                - name: nextcloud-data-persistent-storage
                  mountPath: /var/www/html
                  subPath: data
          restartPolicy: OnFailure
          volumes:
            - name: nextcloud-data-persistent-storage
              persistentVolumeClaim:
                claimName: nextcloud-data-pv-claim
